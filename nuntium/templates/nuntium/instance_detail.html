{% extends "base.html" %}
{% load i18n %}
{% load subdomainurls %}

{% block extrajs %}
{% include 'nuntium/instance_detail.js' with writeitinstance=writeitinstance%}
{% endblock extrajs %}


{% block content %}
{% load markdown_deux_tags %}
<ul class="flash-messages">
{% for message in messages %}
<li>{{ message }}</li>
{% endfor %}
</ul>
<h2>{% trans "You can now write your question" %}</h2>
<form method='post' class='form-horizontal' action="{% url 'instance_detail' subdomain=writeitinstance.slug %}">{% csrf_token %}
    <div ng-controller="message-form">
{{ form.non_field_errors }}
	<div class="fieldWrapper">
        {{ form.author_name.errors }}
        <label for="id_author_name">{% trans "Your name *" %}</label>
        {{ form.author_name }}
    </div>
    <div class="fieldWrapper">
        {{ form.author_email.errors }}
        <label for="id_author_email">{% trans "Your email *" %}</label>
        {{ form.author_email }}
    </div>
    <div class="fieldWrapper">
        {{ form.persons.errors }}
        <label for="id_persons">{% trans "To whom *" %}</label>
        <ul>
            <input type="search" placeholder="{% trans 'Search for people' %}" ng-model="searchTerm"/>
        <li ng-repeat="person in persons | filter:comp" >
            <label for="id_persons_[[$index]]">
                <input id="id_persons_[[$index]]" name="persons" type="checkbox" value="[[person.id]]" /> [[person.name]]</label>
        </li>
        </ul>
    </div>
    <div class="fieldWrapper">
        {{ form.subject.errors }}
        <label for="id_subject">{% trans "Subject *" %}</label>
        {{ form.subject }}
    </div>
    <div class="fieldWrapper">
        {{ form.public.errors }}
        <label for="id_public">{% trans "Public" %}</label>
        {{ form.public }}
    </div>
    <div class="fieldWrapper">
        {{ form.content.errors }}
        <label for="id_content">{% trans "Content *" %}</label>
        {{ form.content }}
    </div>
    
<input type='submit' class='btn btn-primary' value= "{% trans 'Submit Message' %}"/>
</div>
</form>
<div class='instance-search-form'>
    <form action="{% url 'instance_search' subdomain=writeitinstance.slug %}" method="get" >
        <table>
            {{ search_form.as_table }}
            <tr>
                <td>&nbsp;</td>
                <td>
                    <input type="submit" value="{% trans 'Search' %}" />
                </td>
            </tr>
        </table>
    </form>
</div>

{% if writeitinstance.message_set.count == 0 %}
    <h2>{% trans "There are no messages" %}</h2>
{% else %}

    <h2>{% trans "Messages" %}</h2>
    

    {% for message in public_messages %}
        {% include "nuntium/message/message_in_list.html" with message=message %}
        {% if not forloop.last %}
            <hr />
        {% endif %}
    {% endfor %}
{% endif %}

{% endblock content%}
