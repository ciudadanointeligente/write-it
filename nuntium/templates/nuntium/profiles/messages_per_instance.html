{% extends "base_manager.html" %}
{% load i18n %}
{% load subdomainurls %}
{% load staticfiles %}
{% load pagination_tags %}
{% block extrajs %}
{% endblock extrajs %}
{% load nuntium_tags %}






{% block header %}

{% include 'nuntium/profiles/per_instance_top_menu.html' with section='messages_per_writeitinstance' %}

{% endblock header %}

{% block content %}
  <div class="page-header">
    <h2>{% trans "Messages" %}</h2>
  </div>
  <div class="manager-overview">
    {% blocktrans count message_count=writeitinstance.message_set.count %}
    There is <strong>1</strong> message.
    {% plural %}
    There are <strong>{{ message_count }}</strong> total messages.
    {% endblocktrans %}
    {% if writeitinstance.config.moderation_needed_in_all_messages %}
    5 messages await moderation.
    {% endif %}
  </div>
  {% if writeitinstance.config.moderation_needed_in_all_messages %}
    {% autopaginate message_list %}
      {% paginate %}
      <table class="table table-striped">
        <caption><h3>{% trans "Messages awaiting moderation" %}</h3></caption>
        <thead>
          <tr>
            <th>{% trans "Message" %}</th>
            <th class="text-center">{% trans "Replies"%}</th>
            <th class="text-center">{% trans "Confirmed?" %}</th>
            <th class="text-center">{% trans "Public"%}</th>
          </tr>
        </thead>
        <tbody>
          {% for message in message_list %}
          <tr class="message-in-message-list">
            <td>
              <h3><a href="{% url 'message_detail_private' subdomain=writeitinstance.slug pk=message.pk %}">{{ message.subject }}</a></h3>
              <p class="message-in-message-list__meta">
                {% blocktrans with created=message.created|timesince author_name=message.author_name to=message.people|join_with_commas %}
                  Sent <strong>{{ created }}</strong> ago to <strong>{{ to }}</strong> from <strong>{{ author_name }}</strong>
                {% endblocktrans %}
              </p>
            </td>

            <td class="text-center">
              {{ message.answers.count }}
              {% if writeitinstance.config.can_create_answer %}
                <a data-toggle="modal" data-target="#modal" href="{% url 'create_answer' subdomain=writeitinstance.slug pk=message.pk %}" alt="{% trans "Add"%}"><i class="fa fa-plus"></i></a>
              {% endif %}
            </td>

            <td class="text-center">
            {% if message.confirmated %}
              <div class="explanation"  data-toggle="tooltip" data-placement="left" title="{% trans 'The author has confirmed that this was sent from their email' %}">
                <i class="glyphicon glyphicon-ok"></i>
              </div>
            {% else %}
              <div class="explanation"  data-toggle="tooltip" data-placement="left" title="{% trans 'The author has not yet confirmed their email address' %}">
                <i class="glyphicon glyphicon-remove"></i>
              </div>
            {% endif %}
            </td>
            <td class="text-center">
                {% if message.public %}
                <div class="explanation"  data-toggle="tooltip" data-placement="left" title="{% trans 'This message is public, you can make it private by clicking here' %}">
                    <form action="{% url 'toggle_public' pk=message.pk %}" method="post">{% csrf_token %}
                        <input type="checkbox" checked="checked"/>
                    </form>
                </div>
                {% else %}
                <div class="explanation"  data-toggle="tooltip" data-placement="left" title="{% trans 'This message is private, you can make it public by clicking here' %}">
                    <form action="{% url 'toggle_public' pk=message.pk %}" method="post">{% csrf_token %}
                       <input type="checkbox" />
                    </form>
                </div>
                {% endif %}
            </td>

          </tr>
          {% empty %}
          <tr><td colspan="5" class="text-center">{% trans "You have no messages" %}</td></tr>
          {% endfor %}
        </tbody>
      </table>
      {% paginate %}
      {% endif %}
       {% autopaginate message_list %}
      {% paginate %}
      <table class="table table-striped">
        <caption><h3>{% trans "All messages" %}</h3></caption>
        <thead>
          <tr>
            <th>{% trans "Message" %}</th>
            <th class="text-center">{% trans "Replies"%}</th>
            <th class="text-center">{% trans "Confirmed?" %}</th>
            <th class="text-center">{% trans "Public"%}</th>
          </tr>
        </thead>
        <tbody>

        </tbody>
      </table>
      {% paginate %}

<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
     <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">{% trans "Delete this message?"%}</h4>
      </div>
      <div class="modal-body">
        <p>{% trans "Are you sure you want to delete this message? This can't be undone."%}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "No, keep it"%}</button>
        <button type="button" class="btn btn-primary">{% trans "Yes, delete it"%}</button>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
$('.explanation').tooltip({})
</script>
{% endblock content %}
